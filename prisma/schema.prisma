generator client {
    provider = "prisma-client-js"
    output   = "../node_modules/.prisma/client"
    binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
  id               String    @id @default(cuid())
  name             String?
  email            String    @unique
  emailVerified    DateTime?
  password         String?
  image            String?
  role             String    @default("user")
  plan             String    @default("free")
  analysisCount    Int       @default(0)
  analysisResetDate DateTime?
  isBlocked        Boolean   @default(false)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  accounts         Account[]
  sessions         Session[]
  resumeAnalyses   ResumeAnalysis[]
  contractAnalyses ContractAnalysis[]
  subscriptions    Subscription[]
}

model Subscription {
  id              String    @id @default(cuid())
  userId          String
  plan            String
  status          String    @default("active")
  startDate       DateTime  @default(now())
  endDate         DateTime?
  paymentMethod   String?
  paymentId       String?
  amount          Float?
  offerAccepted   Boolean   @default(false)
  offerAcceptedAt DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model ResumeAnalysis {
  id                String   @id @default(cuid())
  userId            String
  resumeText        String?
  resumeFileUrl     String?
  fileName          String?
  targetJobTitle    String
  industry          String
  jobDescription    String?
  analysisResult    Json
  overallScore      Float?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
}

model ContractAnalysis {
  id                String   @id @default(cuid())
  userId            String
  contractText      String?
  contractFileUrl   String?
  fileName          String?
  clientPosition    String
  isCrossBorder     Boolean  @default(false)
  industryType      String?
  analysisResult    Json
  riskLevel         String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model BlogPost {
  id        String   @id @default(cuid())
  titleKk   String?
  titleRu   String?
  titleEn   String?
  titleZh   String?
  contentKk String?  @db.Text
  contentRu String?  @db.Text
  contentEn String?  @db.Text
  contentZh String?  @db.Text
  author    String?
  imageUrl  String?
  published Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TemplateDocument {
  id            String   @id @default(cuid())
  titleKk       String?
  titleRu       String?
  titleEn       String?
  titleZh       String?
  descriptionKk String?
  descriptionRu String?
  descriptionEn String?
  descriptionZh String?
  fileUrl       String?
  category      String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model ContactSubmission {
  id               String   @id @default(cuid())
  name             String
  phone            String
  email            String?
  message          String   @db.Text
  privacyAgreement Boolean  @default(true)
  createdAt        DateTime @default(now())
}
